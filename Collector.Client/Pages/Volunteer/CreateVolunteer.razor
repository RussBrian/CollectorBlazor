@page "/Volunteer/Create"
@using Collector.Client.Components.Shared
@using Collector.Client.Dtos.Volunteer
@using Collector.Client.Services.Volunteer
@inject IVolunteerService _volunteerService
@inject NavigationManager Navigation
@using Microsoft.AspNetCore.Components.Authorization;

@* La vista está protegida mediante roles *@
@* <AuthorizeView Roles="Admin,Institution"> *@
@*     <Authorized> *@
<div class="primary-container">
    <main class="secondary-container">
        <!-- Título principal de la página -->
        <h3 class="title">Crea un voluntariado</h3>

        <div class="card-body-container">
            <!-- Campo para el título del voluntariado -->
            <div class="text-field-container">
                <div class="text-field-style">
                    <div class="d-flex justify-content-between">
                        <label class="custom-label">Título del voluntariado</label>
                        <ToolTipCustom
                            ToolTipTextStyle="font-weight:bold; font-size:small;"
                            ToolTipDescription="Proporcione un título descriptivo para su voluntariado"
                            ToolTipStyle="color:#37490B;" />
                    </div>
                    <MudTextField
                        @bind-Value="ReqVolunteerDto.name"
                        Variant="Variant.Outlined" />
                    <p class="text-secondary">Coloque un título que identifique su voluntariado.</p>
                </div>

                <!-- Campo para la fecha del voluntariado -->
                <div class="text-field-style" style="width: 30%;">
                    <label class="custom-label">Fecha</label>
                    <MudTextField
                        InputType="InputType.Date"
                        @bind-Value="ReqVolunteerDto.volunteerDate"
                        Variant="Variant.Outlined" />
                </div>
            </div>

            <!-- Mapa interactivo para seleccionar la ubicación -->
            <div class="map-container">
                <div>
                    <label class="custom-label">Ubicación</label>
                    <CustomMap
                        Width="100%"
                        Height="400px"
                        OnLocationSelected="HandleLocationSelected" />
                    <MudButton
                        Variant="Variant.Outlined"
                        Style="background-color:transparent; width: 200px; border: 3px solid #767572; color:white; border-radius: 0.5rem; font-weight:bold; margin-top:15px; margin-left:25px;">
                        Confirmar ubicación
                    </MudButton>
                </div>

                <!-- Sección para añadir imágenes -->
                <div>
                    <label class="custom-label">Imágenes</label>
                    <img class="rounded-3" src="./BosqueLindo.png" width="275px" height="250px" />
                    <MudButton
                        Variant="Variant.Outlined"
                        Style="background-color:transparent; width: 155px; border: 3px solid #767572; color: white; border-radius: 0.5rem; font-weight: bold; margin-top:15px; margin-left:50px;">
                        Añadir imagen
                    </MudButton>
                </div>
            </div>

            <!-- Mensaje informativo -->
            <div class="container-message d-flex">
                <MudIcon Icon="@Icons.Material.Filled.ErrorOutline"
                         Size="Size.Small"
                         Style="background-color:darkgray;" />
                <p class="text-secondary">Dar clic sobre el icono para ver más detalles del campo a completar.</p>
            </div>
        </div>

        <!-- Botón para enviar el formulario -->
        <div class="button-send-container">
            <MudButton
                Variant="Variant.Filled"
                ButtonType="ButtonType.Submit"
                Style="background-color:#515B3B; margin-bottom:10px; color:white; width:400px;"
                OnClick="OnSubmit">
                Crear reporte
            </MudButton>
        </div>
    </main>
</div>
    @* </Authorized> *@
    @* <NotAuthorized> *@
    @*     <NoAuthorization RedirectUrl="/"/> *@
    @* </NotAuthorized> *@
@* </AuthorizeView> *@

@code {
    [Parameter]
    public ReqVolunteerDto ReqVolunteerDto { get; set; } = new();

    protected override void OnInitialized()
    {
        ReqVolunteerDto.volunteerDate = DateTime.Now.ToString("dd/MM/yyyy");
    }

  
    private void HandleLocationSelected((double Latitude, double Longitude) location)
    {
        ReqVolunteerDto.longitude = location.Longitude.ToString();
        ReqVolunteerDto.latitude = location.Latitude.ToString();
        Console.WriteLine($"Ubicación seleccionada: Longitud={location.Longitude}, Latitud={location.Latitude}");
    }

    private async Task OnSubmit()
    {
        if (string.IsNullOrWhiteSpace(ReqVolunteerDto.longitude) || string.IsNullOrWhiteSpace(ReqVolunteerDto.latitude))
        {
            Console.WriteLine("Por favor, seleccione una ubicación.");
            return;
        }

        ResVolunteerDto? data = await _volunteerService.CreateVolunteer(ReqVolunteerDto);

        if (data != null)
        {
            Navigation.NavigateTo("/Volunteer/MyVolunteers");
        }
    }
}
<style>
    .custom-textfield {
        border: 2px solid #767572; /* Borde personalizado */
        border-radius: 0.5rem;    /* Bordes redondeados */
        padding: 8px;            /* Espaciado interno */
        font-size: 14px;         /* Tamaño de fuente */
        color: #37490B;          /* Color del texto */
        background-color: #f9f9f9; /* Fondo */
        width: 100%;             /* Ocupa todo el ancho disponible */
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Sombra para mayor profundidad */
    }

    .custom-textfield:focus {
        outline: none; /* Quitar borde por defecto */
        border-color: #515B3B; /* Cambiar color del borde al hacer foco */
        box-shadow: 0 0 5px #515B3B; /* Efecto de brillo */
    }
</style>

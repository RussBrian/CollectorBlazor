@page "/User/Index"
@using Microsoft.AspNetCore.Components.Forms
@inject IJSRuntime JS

<BaseScreen CustomStyles="background-color:white">
    <h3 class="mb-3">Custom File Picker</h3>

    <!-- Hidden file input -->
    <InputFile id="fileInput" hidden OnChange="OnFileSelected" accept="image/*" />

    <!-- Styled button with image preview -->
    <button class="rounded-button" @onclick="TriggerFileInput">
        <img class="rounded-button-img" src="@previewImageUrl" alt="Select an Image" />
    </button>
</BaseScreen>

<style>
    .rounded-button {
        border: none;
        background-color: transparent;
        cursor: pointer;
    }

    .rounded-button-img {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        object-fit: cover; /* Ensure the image fits nicely within the circle */
        border: 2px solid #ccc;
    }
</style>

@code {
    private ElementReference fileInput;
    private string? previewImageUrl = "/ImagenCollector.jpg"; // Default image

    // Triggers the file input click event
    private async Task TriggerFileInput()
    {
        await JS.InvokeVoidAsync("eval", "document.getElementById('fileInput').click()");
    }

    // Handles file selection and updates the image preview
    private async Task OnFileSelected(InputFileChangeEventArgs e)
    {
        var file = e.File; // Get the selected file
        if (file != null)
        {
            // Generate preview URL
            var buffer = new byte[file.Size];
            using var stream = file.OpenReadStream(4 * 1024 * 1024); // Limit to 4MB
            await stream.ReadAsync(buffer);
            previewImageUrl = $"data:{file.ContentType};base64,{Convert.ToBase64String(buffer)}";
        }
    }
}
